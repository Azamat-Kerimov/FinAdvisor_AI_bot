# Правила проекта FinAdvisor (обязательны к соблюдению)

## Источник истины

- Репозиторий — единственный источник истины.
- GitHub всегда содержит актуальное состояние (master/main).
- Локальные файлы на VPS **никогда** не должны перезаписывать состояние из GitHub.

## Поток деплоя

**Строго:** Cursor (локально) → Push в GitHub → на VPS только `git pull`/reset → перезапуск systemd.

1. Разработка и коммиты — только локально (Cursor).
2. Push — в GitHub.
3. На VPS — только получение кода из GitHub и перезапуск сервисов.

## Строгие правила Git

1. **Никогда** не предлагать коммитить, стэшить или сохранять локальные изменения на VPS.
2. **Никогда** не предлагать решать конфликты путём сохранения локальных файлов на VPS.
3. Если на VPS git сообщает о локальных изменениях — **всегда** рекомендовать:
   - отменить локальные изменения;
   - привести репозиторий в точное состояние GitHub.
4. **Никогда** не предлагать править файлы напрямую на VPS.
5. VPS — только цель деплоя, **не** среда разработки.

## Файл .env

- **Единственный** файл, который может отличаться на VPS — `.env`.
- `.env` **никогда** не коммитить.
- Все остальные файлы на VPS должны **точно** совпадать с GitHub.

## Фронтенд

- React-фронтенд **должен** собираться на VPS.
- `node_modules` могут быть на VPS и **не** коммитятся.
- `frontend/dist` **не** коммитить.
- `npm install` запускать **только** если изменились `package.json` или `package-lock.json`.
- Не удалять `node_modules` без явной необходимости.

## Предпочтительные команды на VPS

После подключения к VPS для обновления кода:

```bash
git fetch
git reset --hard origin/main
git clean -fd -e .env
```

После pull/reset — только перезапуск systemd-сервисов.

- **Никогда** не переинициализировать git-репозиторий.
- **Никогда** не предлагать удалять каталог репозитория.

## Systemd

- Сервисы systemd должны запускаться с **абсолютными путями**.
- Не полагаться на активацию venv в shell.
- Использовать напрямую: `/root/FinAdvisor_AI_bot/venv/bin/python`.

## Цель

- Нулевые ручные правки на VPS.
- Нулевые конфликты слияния на VPS.
- Нулевые ошибки вида «local changes would be overwritten».

**Если инструкция нарушает эти правила — не предлагать её.**
