<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="FinAdvisor - –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫">
    <title>FinAdvisor - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- CSS Modules -->
    <link rel="stylesheet" href="/static/css/style.css?v=9.0">
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>
<body>
    <div id="app">
        <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="main-menu" class="screen active">
            <div class="header">
                <h1>FinAdvisor</h1>
                <p class="subtitle">–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫</p>
            </div>
            
            <!-- –ë–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç–æ—á–∫–∞ -->
            <div id="stats-card">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
                </div>
            </div>
            
            <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (—Ç–æ–ª—å–∫–æ –Ω–∞–≤–∏–≥–∞—Ü–∏—è, –±–µ–∑ —Ñ–æ—Ä–º) -->
            <div class="main-menu-grid">
                <button class="menu-btn" onclick="showScreen('transactions')">
                    <span class="menu-btn-icon">üí∞</span>
                    <span class="menu-btn-text">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</span>
                </button>
                <button class="menu-btn" onclick="showScreen('capital')">
                    <span class="menu-btn-icon">üíº</span>
                    <span class="menu-btn-text">–ö–∞–ø–∏—Ç–∞–ª</span>
                </button>
                <button class="menu-btn" onclick="showScreen('consultation')">
                    <span class="menu-btn-icon">ü§ñ</span>
                    <span class="menu-btn-text">–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</span>
                </button>
            </div>
        </div>

        <!-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
        <div id="transactions" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showScreen('main-menu')">‚Üê –ù–∞–∑–∞–¥</button>
                <h2>–û–ø–µ—Ä–∞—Ü–∏–∏</h2>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ (–¢–ó 2.2.2) -->
            <div class="import-bar">
                <input type="file" id="import-file-input" accept=".pdf,.png,.jpg,.jpeg,.xlsx,.xls" style="display:none">
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('import-file-input').click()">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</button>
            </div>
            
            <!-- –§–∏–ª—å—Ç—Ä—ã -->
            <div class="filters-bar">
                <select id="filter-month" class="filter-select" onchange="applyTransactionFilters()">
                    <option value="">–ú–µ—Å—è—Ü</option>
                    <option value="1">–Ø–Ω–≤–∞—Ä—å</option>
                    <option value="2">–§–µ–≤—Ä–∞–ª—å</option>
                    <option value="3">–ú–∞—Ä—Ç</option>
                    <option value="4">–ê–ø—Ä–µ–ª—å</option>
                    <option value="5">–ú–∞–π</option>
                    <option value="6">–ò—é–Ω—å</option>
                    <option value="7">–ò—é–ª—å</option>
                    <option value="8">–ê–≤–≥—É—Å—Ç</option>
                    <option value="9">–°–µ–Ω—Ç—è–±—Ä—å</option>
                    <option value="10">–û–∫—Ç—è–±—Ä—å</option>
                    <option value="11">–ù–æ—è–±—Ä—å</option>
                    <option value="12">–î–µ–∫–∞–±—Ä—å</option>
                </select>
                <select id="filter-year" class="filter-select" onchange="applyTransactionFilters()"></select>
                <select id="filter-category" class="filter-select" onchange="applyTransactionFilters()">
                    <option value="">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</option>
                </select>
                <select id="filter-type" class="filter-select" onchange="applyTransactionFilters()">
                    <option value="">–¢–∏–ø</option>
                    <option value="income">–î–æ—Ö–æ–¥—ã</option>
                    <option value="expense">–†–∞—Å—Ö–æ–¥—ã</option>
                </select>
            </div>
            
            <!-- –°–≤–æ–¥–∫–∏: –¢—Ä–∞—Ç—ã –∏ –î–æ—Ö–æ–¥—ã -->
            <div id="transactions-summary" class="transactions-summary"></div>
            
            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
            <div id="transaction-form" class="form">
                <div class="form-group">
                    <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select id="category-select" class="input"></select>
                </div>
                <div class="form-group">
                    <label class="form-label">–°—É–º–º–∞</label>
                    <input type="number" id="amount-input" class="input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1500)" step="0.01" min="0" onkeypress="if(event.key==='Enter') addTransaction()">
                </div>
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="text" id="description-input" class="input" placeholder="–î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ" onkeypress="if(event.key==='Enter') addTransaction()">
                </div>
                <button class="btn btn-primary" onclick="addTransaction()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ) -->
            <div id="transactions-list" class="list"></div>
        </div>

        <!-- –ö–∞–ø–∏—Ç–∞–ª -->
        <div id="capital" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showScreen('main-menu')">‚Üê –ù–∞–∑–∞–¥</button>
                <h2>–ö–∞–ø–∏—Ç–∞–ª</h2>
            </div>
            
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" data-tab="assets" onclick="switchCapitalTab('assets')">–ê–∫—Ç–∏–≤—ã</button>
                <button class="tab" data-tab="liabilities" onclick="switchCapitalTab('liabilities')">–î–æ–ª–≥–∏</button>
            </div>
            
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∫–∞–ø–∏—Ç–∞–ª–∞ -->
            <div id="capital-content"></div>
        </div>

        <!-- –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è -->
        <div id="consultation" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showScreen('main-menu')">‚Üê –ù–∞–∑–∞–¥</button>
                <h2>–õ–∏—á–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</h2>
            </div>
            
            <!-- –í–≤–æ–¥ —Ü–µ–ª–µ–π —á–µ—Ä–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
            <div class="consultation-message-bar">
                <input type="text" id="consultation-message-input" class="input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –•–æ—á—É –Ω–∞–∫–æ–ø–∏—Ç—å 1 000 000 –∑–∞ 2 –≥–æ–¥–∞" maxlength="500">
                <button type="button" class="btn btn-primary" id="consultation-send-btn" onclick="sendConsultationMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
            
            <div id="consultation-content" class="content"></div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
    <div id="edit-transaction-modal" class="modal" style="display:none;">
        <div class="modal-backdrop" onclick="closeEditTransactionModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</h3>
                <button type="button" class="modal-close" onclick="closeEditTransactionModal()">√ó</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-tx-id" value="">
                <div class="form-group">
                    <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select id="edit-tx-category" class="input"></select>
                </div>
                <div class="form-group">
                    <label class="form-label">–°—É–º–º–∞ (‚ÇΩ)</label>
                    <input type="number" id="edit-tx-amount" class="input" step="0.01" placeholder="–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ ‚Äî –¥–æ—Ö–æ–¥, –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ ‚Äî —Ä–∞—Å—Ö–æ–¥">
                </div>
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <input type="text" id="edit-tx-description" class="input" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeEditTransactionModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="saveEditTransaction()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–º–ø–æ—Ä—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π -->
    <div id="import-modal" class="modal" style="display:none;">
        <div class="modal-backdrop" onclick="closeImportModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–º–ø–æ—Ä—Ç–∞</h3>
                <button type="button" class="modal-close" onclick="closeImportModal()">√ó</button>
            </div>
            <div id="import-preview-list" class="import-preview-list"></div>
            <div id="import-errors" class="import-errors"></div>
            <div class="modal-actions">
                <button type="button" class="btn btn-primary" onclick="applyImport('add')">üü¢ –î–æ–±–∞–≤–∏—Ç—å –∫ —Ç–µ–∫—É—â–∏–º</button>
                <button type="button" class="btn btn-danger" onclick="applyImport('replace')">üî¥ –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ</button>
            </div>
        </div>
    </div>

    <!-- Floating Action Button –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
    <button class="fab" onclick="showAddTransactionForm('expense')" title="–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é" id="fab-add-transaction" style="display: none;">
        ‚ûï
    </button>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
        <button class="nav-item active" data-screen="main-menu" onclick="showScreen('main-menu')">
            <span class="nav-item-icon">üè†</span>
            <span class="nav-item-label">–ì–ª–∞–≤–Ω–∞—è</span>
        </button>
        <button class="nav-item" data-screen="transactions" onclick="showScreen('transactions')">
            <span class="nav-item-icon">üí∞</span>
            <span class="nav-item-label">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</span>
        </button>
        <button class="nav-item" data-screen="capital" onclick="showScreen('capital')">
            <span class="nav-item-icon">üíº</span>
            <span class="nav-item-label">–ö–∞–ø–∏—Ç–∞–ª</span>
        </button>
        <button class="nav-item" data-screen="consultation" onclick="showScreen('consultation')">
            <span class="nav-item-icon">ü§ñ</span>
            <span class="nav-item-label">–ò–ò</span>
        </button>
    </nav>

    <!-- JavaScript Modules (load in order) -->
    <script src="/static/js/state.js?v=9.0"></script>
    <script src="/static/js/api.js?v=9.0"></script>
    <script src="/static/js/ui.js?v=9.0"></script>
    <script src="/static/js/app.js?v=9.0"></script>
</body>
</html>
